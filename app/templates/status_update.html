<!-- Status Header -->
<div class="flex items-center justify-between mb-6">
    <h2 class="text-2xl font-bold">部署状态</h2>
    <div class="text-sm text-base-content/60">
        最后更新: <span id="timestamp">刚刚</span>
    </div>
</div>

<!-- Status Display -->
{% if status == "PENDING" %}
<div class="flex items-center space-x-4 p-6 bg-warning/10 border border-warning/20 rounded-lg">
    <div class="loading loading-spinner loading-md text-warning"></div>
    <div>
        <h3 class="text-lg font-semibold text-warning">等待处理</h3>
        <p class="text-sm text-base-content/70">您的部署任务已提交，正在队列中等待处理...</p>
    </div>
</div>

{% elif status == "IN_PROGRESS" %}
<div class="flex items-center space-x-4 p-6 bg-info/10 border border-info/20 rounded-lg">
    <div class="loading loading-spinner loading-md text-info"></div>
    <div>
        <h3 class="text-lg font-semibold text-info">部署中</h3>
        <p class="text-sm text-base-content/70">正在克隆代码并部署到 HuggingFace Spaces，请耐心等待...</p>
    </div>
</div>

<!-- Progress Steps -->
<div class="mt-6">
    <ul class="steps steps-vertical lg:steps-horizontal w-full">
        <li class="step step-primary">创建任务</li>
        <li class="step step-primary">克隆代码</li>
        <li class="step step-primary">构建应用</li>
        <li class="step">部署完成</li>
    </ul>
</div>

{% elif status == "SUCCESS" %}
<div class="flex items-center space-x-4 p-6 bg-success/10 border border-success/20 rounded-lg">
    <i data-lucide="check-circle" class="w-8 h-8 text-success"></i>
    <div class="flex-1">
        <h3 class="text-lg font-semibold text-success">部署成功！</h3>
        <p class="text-sm text-base-content/70">您的应用已成功部署到 HuggingFace Spaces</p>
    </div>
</div>

<!-- Success Details -->
{% if detail and detail.space_url %}
<div class="mt-6 space-y-4">
    <div class="alert alert-success">
        <i data-lucide="external-link" class="w-5 h-5"></i>
        <div class="flex-1">
            <h4 class="font-bold">应用已上线</h4>
            <p class="text-sm">您的应用现在可以通过以下链接访问：</p>
        </div>
    </div>
    
    <div class="card bg-base-200">
        <div class="card-body">
            <div class="flex items-center justify-between">
                <div>
                    <h4 class="font-semibold">Space URL</h4>
                    <a href="{{ detail.space_url }}" target="_blank" class="link link-primary text-lg">
                        {{ detail.space_url }}
                    </a>
                </div>
                <div class="space-x-2">
                    <a href="{{ detail.space_url }}" target="_blank" class="btn btn-primary">
                        <i data-lucide="external-link" class="w-4 h-4 mr-2"></i>
                        访问应用
                    </a>
                    <button 
                        onclick="copyToClipboard('{{ detail.space_url }}')"
                        class="btn btn-ghost"
                        title="复制链接"
                    >
                        <i data-lucide="copy" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Completed Steps -->
<div class="mt-6">
    <ul class="steps steps-vertical lg:steps-horizontal w-full">
        <li class="step step-primary">创建任务</li>
        <li class="step step-primary">克隆代码</li>
        <li class="step step-primary">构建应用</li>
        <li class="step step-primary">部署完成</li>
    </ul>
</div>

{% elif status == "FAILED" %}
<div class="flex items-center space-x-4 p-6 bg-error/10 border border-error/20 rounded-lg">
    <i data-lucide="alert-circle" class="w-8 h-8 text-error"></i>
    <div>
        <h3 class="text-lg font-semibold text-error">部署失败</h3>
        <p class="text-sm text-base-content/70">部署过程中遇到错误，请查看详细信息</p>
    </div>
</div>

<!-- Error Details -->
{% if detail and detail.error %}
<div class="mt-6">
    <div class="alert alert-error">
        <i data-lucide="x-circle" class="w-5 h-5"></i>
        <div>
            <h4 class="font-bold">错误详情</h4>
            <div class="text-sm mt-2">
                <code class="bg-error/20 text-error px-2 py-1 rounded text-xs">
                    {{ detail.error }}
                </code>
            </div>
        </div>
    </div>
    
    <div class="mt-4 card bg-base-200">
        <div class="card-body">
            <h4 class="font-semibold mb-2">常见解决方案</h4>
            <ul class="text-sm space-y-1">
                <li>• 检查 HuggingFace Token 是否有效且具有写入权限</li>
                <li>• 确保 Git 仓库 URL 可访问</li>
                <li>• 验证仓库中包含有效的 Dockerfile</li>
                <li>• 检查 Space 名称是否已被使用</li>
            </ul>
        </div>
    </div>
</div>
{% endif %}

<!-- Failed Steps -->
<div class="mt-6">
    <ul class="steps steps-vertical lg:steps-horizontal w-full">
        <li class="step step-primary">创建任务</li>
        <li class="step step-error">处理失败</li>
        <li class="step">构建应用</li>
        <li class="step">部署完成</li>
    </ul>
</div>

{% else %}
<div class="flex items-center space-x-4 p-6 bg-base-200 border border-base-300 rounded-lg">
    <i data-lucide="help-circle" class="w-8 h-8 text-base-content/50"></i>
    <div>
        <h3 class="text-lg font-semibold">未知状态</h3>
        <p class="text-sm text-base-content/70">当前状态: {{ status }}</p>
    </div>
</div>
{% endif %}

<!-- Auto-refresh notice -->
<div class="mt-6 text-center">
    <p class="text-xs text-base-content/50">
        <i data-lucide="refresh-cw" class="w-3 h-3 inline mr-1"></i>
        页面每 2 秒自动刷新状态
    </p>
</div>

<script>
    // Update timestamp
    document.getElementById('timestamp').textContent = new Date().toLocaleTimeString('zh-CN');
    
    // Auto-stop polling for final states
    {% if status == "SUCCESS" or status == "FAILED" %}
    // Stop auto-refresh for final states
    setTimeout(function() {
        const statusContainer = document.getElementById('status-container');
        if (statusContainer) {
            statusContainer.removeAttribute('hx-trigger');
        }
    }, 100);
    {% endif %}
</script> 